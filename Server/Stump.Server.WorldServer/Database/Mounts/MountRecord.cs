using System;
using System.Collections.Generic;
using Stump.Core.IO;
using Stump.ORM;
using Stump.ORM.SubSonic.SQLGeneration.Schema;
using Stump.Server.WorldServer.Game.Actors.RolePlay.Mounts;

namespace Stump.Server.WorldServer.Database.Mounts
{
    public class MountRecordRelator
    {
        public static string FetchQuery = "SELECT * FROM mounts";
        /// <summary>
        /// Use string.Format
        /// </summary>
        public static string FindById = "SELECT * FROM mounts WHERE Id={0}";

        public static string FetchByPaddockId = "SELECT mounts.* FROM mounts JOIN mounts_paddocks ON mounts.Id = mounts_paddocks.MountId WHERE mounts_paddocks.PaddockId={0} AND Stabled={1}";
    }

    [TableName("mounts")]
    public class MountRecord : IAutoGeneratedRecord
    {
        private string m_behaviorsCSV;
        private IEnumerable<uint> m_behaviors;

        [Index]
        [PrimaryKey("Id")]
        public int Id
        {
            get;
            set;
        }

        [Ignore]
        public bool IsNew
        {
            get;
            set;
        }

        public String Name
        {
            get;
            set;
        }

        public Boolean Sex
        {
            get;
            set;
        }

        public int TemplateId
        {
            get;
            set;
        }

        [Ignore]
        public MountTemplate Model
        {
            get { return MountManager.Instance.GetTemplate(TemplateId); }
        }

        public long Experience
        {
            get;
            set;
        }

        public sbyte GivenExperience
        {
            get;
            set;
        }

        public int Stamina
        {
            get;
            set;
        }

        public int Maturity
        {
            get;
            set;
        }

        public int Energy
        {
            get;
            set;
        }

        public int Serenity
        {
            get;
            set;
        }

        public int Love
        {
            get;
            set;
        }

        public int ReproductionCount
        {
            get;
            set;
        }

        [Ignore]
        public IEnumerable<uint> Behaviors
        {
            get
            {
                return m_behaviors ??
                       (m_behaviors = BehaviorsCSV.FromCSV<uint>(","));
            }
            set
            {
                m_behaviors = value;
                BehaviorsCSV = value.ToCSV(",");
            }
        }

        public string BehaviorsCSV
        {
            get { return m_behaviorsCSV; }
            set
            {
                m_behaviorsCSV = value;
                m_behaviors = BehaviorsCSV.FromCSV<uint>(",");
            }
        }
    }
}
